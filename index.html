<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kitchen Recipe Generator</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .animate-spin {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .sync-indicator {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .section-divider {
            border-top: 2px solid #e5e7eb;
            margin: 1rem 0;
            position: relative;
        }
        .section-divider::before {
            content: '';
            position: absolute;
            top: -1px;
            left: 50%;
            transform: translateX(-50%);
            width: 20px;
            height: 2px;
            background: #9ca3af;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Icon components
        const ChefHat = ({ className = "", size = 24 }) => (
            <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="m15 11-1 9h-4l-1-9"/>
                <path d="m5 11 1-2c0-5 4-7 8-7s8 2 8 7l1 2-4.5 0.5"/>
                <path d="m4 11 5-8"/>
                <path d="m20 11-5-8"/>
            </svg>
        );

        const Plus = ({ size = 16 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M5 12h14"/>
                <path d="M12 5v14"/>
            </svg>
        );

        const Edit2 = ({ size = 14 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
            </svg>
        );

        const Trash2 = ({ size = 14 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="3,6 5,6 21,6"/>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                <line x1="10" y1="11" x2="10" y2="17"/>
                <line x1="14" y1="11" x2="14" y2="17"/>
            </svg>
        );

        const Check = ({ size = 14 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="20,6 9,17 4,12"/>
            </svg>
        );

        const Utensils = ({ size = 16 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"/>
                <path d="M7 2v20"/>
                <path d="M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7"/>
            </svg>
        );

        const AlertTriangle = ({ className = "", size = 20 }) => (
            <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                <line x1="12" y1="9" x2="12" y2="13"/>
                <line x1="12" y1="17" x2="12.01" y2="17"/>
            </svg>
        );

        const Cloud = ({ size = 16, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z"/>
            </svg>
        );

        const User = ({ size = 16 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                <circle cx="12" cy="7" r="4"/>
            </svg>
        );

        const X = ({ size = 20 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M18 6 6 18"/>
                <path d="M6 6l12 12"/>
            </svg>
        );

        const RecipeGenerator = () => {
            // Default pantry items with comprehensive options
            const getDefaultPantryItems = () => ({
                oils: [
                    { id: 1, name: 'Olive Oil (Extra Virgin)', available: true },
                    { id: 2, name: 'Olive Oil (Light/Regular)', available: false },
                    { id: 3, name: 'Vegetable Oil', available: false },
                    { id: 4, name: 'Canola Oil', available: false },
                    { id: 5, name: 'Avocado Oil', available: false },
                    { id: 6, name: 'Coconut Oil (Refined)', available: false },
                    { id: 7, name: 'Coconut Oil (Virgin)', available: false },
                    { id: 8, name: 'Sesame Oil (Toasted)', available: false },
                    { id: 9, name: 'Grapeseed Oil', available: false },
                    { id: 10, name: 'Sunflower Oil', available: false },
                    { id: 11, name: 'Peanut Oil', available: false },
                    { id: 12, name: 'Corn Oil', available: false },
                    { id: 13, name: 'Safflower Oil', available: false },
                    { id: 14, name: 'Soybean Oil', available: false },
                    { id: 15, name: 'Walnut Oil', available: false },
                    { id: 16, name: 'Flaxseed Oil', available: false },
                    { id: 17, name: 'Pumpkin Seed Oil', available: false },
                    { id: 18, name: 'Butter (Salted)', available: false },
                    { id: 19, name: 'Butter (Unsalted)', available: false },
                    { id: 20, name: 'Ghee / Clarified Butter', available: false },
                    { id: 21, name: 'Lard', available: false },
                    { id: 22, name: 'Duck Fat', available: false },
                    { id: 23, name: 'Bacon Grease', available: false },
                    { id: 24, name: 'Shortening (Crisco)', available: false }
                ],
                herbs: [
                    { id: 1, name: 'Basil (Dried)', available: false },
                    { id: 2, name: 'Oregano', available: false },
                    { id: 3, name: 'Thyme', available: false },
                    { id: 4, name: 'Rosemary', available: false },
                    { id: 5, name: 'Parsley (Dried)', available: false },
                    { id: 6, name: 'Dill', available: false },
                    { id: 7, name: 'Sage', available: false },
                    { id: 8, name: 'Marjoram', available: false },
                    { id: 9, name: 'Bay Leaves', available: false },
                    { id: 10, name: 'Tarragon', available: false },
                    { id: 11, name: 'Cilantro (Dried)', available: false },
                    { id: 12, name: 'Mint (Dried)', available: false }
                ],
                spices: [
                    { id: 1, name: 'Black Pepper', available: true },
                    { id: 2, name: 'White Pepper', available: false },
                    { id: 3, name: 'Crushed Red Pepper', available: false },
                    { id: 4, name: 'Cayenne Pepper', available: false },
                    { id: 5, name: 'Chili Powder', available: false },
                    { id: 6, name: 'Smoked Paprika', available: false },
                    { id: 7, name: 'Sweet Paprika', available: false },
                    { id: 8, name: 'Cumin', available: false },
                    { id: 9, name: 'Coriander', available: false },
                    { id: 10, name: 'Turmeric', available: false },
                    { id: 11, name: 'Ginger (Ground)', available: false },
                    { id: 12, name: 'Nutmeg', available: false },
                    { id: 13, name: 'Cloves (Ground)', available: false },
                    { id: 14, name: 'Cloves (Whole)', available: false },
                    { id: 15, name: 'Allspice', available: false },
                    { id: 16, name: 'Cardamom', available: false },
                    { id: 17, name: 'Cinnamon', available: false },
                    { id: 18, name: 'Mustard Powder', available: false },
                    { id: 19, name: 'Fennel Seed', available: false },
                    { id: 20, name: 'Caraway Seed', available: false },
                    { id: 21, name: 'Anise Seed', available: false }
                ],
                blends: [
                    { id: 1, name: 'Italian Seasoning', available: false },
                    { id: 2, name: 'Herbs de Provence', available: false },
                    { id: 3, name: 'Taco Seasoning', available: false },
                    { id: 4, name: 'Cajun Seasoning', available: false },
                    { id: 5, name: 'Creole Seasoning', available: false },
                    { id: 6, name: 'Old Bay', available: false },
                    { id: 7, name: 'Garam Masala', available: false },
                    { id: 8, name: 'Chinese Five Spice', available: false },
                    { id: 9, name: "Za'atar", available: false },
                    { id: 10, name: 'Curry Powder', available: false },
                    { id: 11, name: 'Ras el Hanout', available: false },
                    { id: 12, name: 'Gochugaru (Korean Chili)', available: false },
                    { id: 13, name: 'Aleppo Pepper', available: false }
                ],
                salts: [
                    { id: 1, name: 'Kosher Salt', available: true },
                    { id: 2, name: 'Sea Salt', available: false },
                    { id: 3, name: 'Table Salt', available: false },
                    { id: 4, name: 'Himalayan Pink Salt', available: false },
                    { id: 5, name: 'Flaky Salt (Maldon)', available: false },
                    { id: 6, name: 'Garlic Salt', available: false },
                    { id: 7, name: 'Celery Salt', available: false },
                    { id: 8, name: 'Onion Salt', available: false },
                    { id: 9, name: 'Seasoned Salt', available: false }
                ],
                other_seasonings: [
                    { id: 1, name: 'MSG (Ajinomoto)', available: false },
                    { id: 2, name: 'Chicken Bouillon', available: false },
                    { id: 3, name: 'Beef Bouillon', available: false },
                    { id: 4, name: 'Vegetable Bouillon', available: false },
                    { id: 5, name: 'Nutritional Yeast', available: false }
                ],
                vinegars: [
                    { id: 1, name: 'Distilled White Vinegar', available: false },
                    { id: 2, name: 'Apple Cider Vinegar', available: false },
                    { id: 3, name: 'White Wine Vinegar', available: false },
                    { id: 4, name: 'Red Wine Vinegar', available: false },
                    { id: 5, name: 'Balsamic Vinegar', available: false },
                    { id: 6, name: 'Sherry Vinegar', available: false },
                    { id: 7, name: 'Champagne Vinegar', available: false },
                    { id: 8, name: 'Rice Vinegar (Unseasoned)', available: false },
                    { id: 9, name: 'Seasoned Rice Vinegar', available: false },
                    { id: 10, name: 'Malt Vinegar', available: false },
                    { id: 11, name: 'Coconut Vinegar', available: false },
                    { id: 12, name: 'Black Vinegar (Chinese)', available: false },
                    { id: 13, name: 'Cane Vinegar', available: false },
                    { id: 14, name: 'Ume Plum Vinegar', available: false }
                ],
                sauces: [
                    { id: 1, name: 'Soy Sauce', available: false },
                    { id: 2, name: 'Tamari', available: false },
                    { id: 3, name: 'Coconut Aminos', available: false },
                    { id: 4, name: 'Fish Sauce', available: false },
                    { id: 5, name: 'Oyster Sauce', available: false },
                    { id: 6, name: 'Hoisin Sauce', available: false },
                    { id: 7, name: 'Worcestershire Sauce', available: false },
                    { id: 8, name: 'Sriracha', available: false },
                    { id: 9, name: 'Hot Sauce (Tabasco)', available: false },
                    { id: 10, name: "Frank's RedHot", available: false },
                    { id: 11, name: 'Chili Garlic Sauce', available: false },
                    { id: 12, name: 'Gochujang', available: false },
                    { id: 13, name: 'Harissa', available: false },
                    { id: 14, name: 'BBQ Sauce', available: false },
                    { id: 15, name: 'Buffalo Sauce', available: false },
                    { id: 16, name: 'Teriyaki Sauce', available: false },
                    { id: 17, name: 'Red Curry Paste', available: false },
                    { id: 18, name: 'Green Curry Paste', available: false },
                    { id: 19, name: 'Yellow Curry Paste', available: false }
                ],
                condiments: [
                    { id: 1, name: 'Ketchup', available: false },
                    { id: 2, name: 'Yellow Mustard', available: false },
                    { id: 3, name: 'Dijon Mustard', available: false },
                    { id: 4, name: 'Spicy Brown Mustard', available: false },
                    { id: 5, name: 'Whole Grain Mustard', available: false },
                    { id: 6, name: 'Mayonnaise', available: false },
                    { id: 7, name: 'Miracle Whip', available: false },
                    { id: 8, name: 'Sweet Relish', available: false },
                    { id: 9, name: 'Dill Relish', available: false },
                    { id: 10, name: 'Tahini', available: false },
                    { id: 11, name: 'Pesto', available: false },
                    { id: 12, name: 'Salsa', available: false },
                    { id: 13, name: 'Chimichurri', available: false },
                    { id: 14, name: 'Aioli', available: false },
                    { id: 15, name: 'Tomato Paste', available: false },
                    { id: 16, name: 'Tomato Sauce', available: false },
                    { id: 17, name: 'Marinara', available: false }
                ],
                sweeteners: [
                    { id: 1, name: 'Granulated White Sugar', available: false },
                    { id: 2, name: 'Brown Sugar (Light)', available: false },
                    { id: 3, name: 'Brown Sugar (Dark)', available: false },
                    { id: 4, name: 'Powdered Sugar', available: false },
                    { id: 5, name: 'Cane Sugar', available: false },
                    { id: 6, name: 'Turbinado Sugar', available: false },
                    { id: 7, name: 'Honey', available: false },
                    { id: 8, name: 'Maple Syrup', available: false },
                    { id: 9, name: 'Agave Syrup', available: false },
                    { id: 10, name: 'Corn Syrup', available: false },
                    { id: 11, name: 'Molasses (Light)', available: false },
                    { id: 12, name: 'Blackstrap Molasses', available: false },
                    { id: 13, name: 'Date Syrup', available: false },
                    { id: 14, name: 'Coconut Sugar', available: false },
                    { id: 15, name: 'Stevia', available: false },
                    { id: 16, name: 'Monk Fruit Sweetener', available: false },
                    { id: 17, name: 'Erythritol', available: false }
                ],
                grains: [
                    { id: 1, name: 'All-Purpose Flour', available: false },
                    { id: 2, name: 'Bread Flour', available: false },
                    { id: 3, name: 'Whole Wheat Flour', available: false },
                    { id: 4, name: 'White Rice', available: false },
                    { id: 5, name: 'Brown Rice', available: false },
                    { id: 6, name: 'Jasmine Rice', available: false },
                    { id: 7, name: 'Basmati Rice', available: false },
                    { id: 8, name: 'Arborio Rice', available: false },
                    { id: 9, name: 'Wild Rice', available: false },
                    { id: 10, name: 'Quinoa', available: false },
                    { id: 11, name: 'Rolled Oats', available: false },
                    { id: 12, name: 'Steel Cut Oats', available: false },
                    { id: 13, name: 'Barley', available: false },
                    { id: 14, name: 'Farro', available: false },
                    { id: 15, name: 'Bulgur', available: false },
                    { id: 16, name: 'Couscous', available: false },
                    { id: 17, name: 'Breadcrumbs (Plain)', available: false },
                    { id: 18, name: 'Panko Breadcrumbs', available: false }
                ],
                pasta: [
                    { id: 1, name: 'Spaghetti', available: false },
                    { id: 2, name: 'Penne', available: false },
                    { id: 3, name: 'Fusilli', available: false },
                    { id: 4, name: 'Rigatoni', available: false },
                    { id: 5, name: 'Farfalle', available: false },
                    { id: 6, name: 'Linguine', available: false },
                    { id: 7, name: 'Fettuccine', available: false },
                    { id: 8, name: 'Angel Hair', available: false },
                    { id: 9, name: 'Lasagna Sheets', available: false },
                    { id: 10, name: 'Macaroni', available: false },
                    { id: 11, name: 'Orzo', available: false },
                    { id: 12, name: 'Egg Noodles', available: false }
                ],
                canned: [
                    { id: 1, name: 'Diced Tomatoes', available: false },
                    { id: 2, name: 'Crushed Tomatoes', available: false },
                    { id: 3, name: 'Whole Tomatoes', available: false },
                    { id: 4, name: 'Tomato Puree', available: false },
                    { id: 5, name: 'Black Beans', available: false },
                    { id: 6, name: 'Kidney Beans', available: false },
                    { id: 7, name: 'Chickpeas', available: false },
                    { id: 8, name: 'White Beans', available: false },
                    { id: 9, name: 'Pinto Beans', available: false },
                    { id: 10, name: 'Coconut Milk (Full Fat)', available: false },
                    { id: 11, name: 'Coconut Milk (Light)', available: false },
                    { id: 12, name: 'Chicken Broth', available: false },
                    { id: 13, name: 'Vegetable Broth', available: false },
                    { id: 14, name: 'Beef Broth', available: false },
                    { id: 15, name: 'Corn (Whole Kernel)', available: false },
                    { id: 16, name: 'Green Chiles', available: false }
                ],
                baking: [
                    { id: 1, name: 'Baking Powder', available: false },
                    { id: 2, name: 'Baking Soda', available: false },
                    { id: 3, name: 'Active Dry Yeast', available: false },
                    { id: 4, name: 'Instant Yeast', available: false },
                    { id: 5, name: 'Vanilla Extract', available: false },
                    { id: 6, name: 'Almond Extract', available: false },
                    { id: 7, name: 'Cocoa Powder', available: false },
                    { id: 8, name: 'Dark Chocolate Chips', available: false },
                    { id: 9, name: 'Semi-Sweet Chocolate Chips', available: false },
                    { id: 10, name: 'White Chocolate Chips', available: false },
                    { id: 11, name: 'Cream of Tartar', available: false },
                    { id: 12, name: 'Cornstarch', available: false }
                ]
            });

            // User management functions
            const getUserId = () => {
                let username = localStorage.getItem('username');
                if (username) return username;
                
                let userId = localStorage.getItem('user_id');
                if (!userId) {
                    userId = 'user_' + Math.random().toString(36).substr(2, 9) + '_' + Date.now();
                    localStorage.setItem('user_id', userId);
                }
                return userId;
            };

            const setUsername = (newUsername) => {
                if (!newUsername || newUsername.trim() === '') return false;
                
                const cleanUsername = newUsername.toLowerCase().replace(/[^a-z0-9-_]/g, '');
                if (cleanUsername.length < 2) {
                    alert('Username must be at least 2 characters long and contain only letters, numbers, hyphens, and underscores');
                    return false;
                }
                
                localStorage.setItem('username', cleanUsername);
                setUserId(cleanUsername);
                setShowUserModal(false);
                loadDataForUser(cleanUsername);
                return true;
            };

            const loadDataForUser = async (targetUserId) => {
                try {
                    setIsSyncing(true);
                    const response = await fetch(`/.netlify/functions/github-sync?userId=${targetUserId}`, {
                        method: 'GET',
                    });

                    if (response.ok) {
                        const data = await response.json();
                        if (data.ingredients && data.ingredients.length > 0) {
                            setIngredients(data.ingredients);
                        }
                        if (data.equipment && data.equipment.length > 0) {
                            setEquipment(data.equipment);
                        }
                        if (data.pantryItems) {
                            setPantryItems(data.pantryItems);
                        }
                        setSyncStatus('synced');
                    } else {
                        setSyncStatus('synced');
                    }
                } catch (error) {
                    console.error('Error loading data for user:', error);
                    setSyncStatus('error');
                } finally {
                    setIsSyncing(false);
                }
            };

            const clearUsername = () => {
                localStorage.removeItem('username');
                const newId = 'user_' + Math.random().toString(36).substr(2, 9) + '_' + Date.now();
                localStorage.setItem('user_id', newId);
                setUserId(newId);
                setShowUserModal(false);
                // Reset to defaults with expanded pantry
                setIngredients([
                    { id: 1, name: 'Chicken Breast', quantity: 2, unit: 'lbs', category: 'Protein', expires: '2025-08-05' },
                    { id: 2, name: 'Basmati Rice', quantity: 1, unit: 'cup', category: 'Grain', expires: '2026-01-01' },
                    { id: 3, name: 'Heavy Cream', quantity: 1, unit: 'cup', category: 'Dairy', expires: '2025-08-03' },
                    { id: 4, name: 'Mushrooms', quantity: 8, unit: 'oz', category: 'Vegetable', expires: '2025-08-04' }
                ]);
                setEquipment([
                    { id: 1, name: 'Sous Vide Immersion Circulator', type: 'Precision Cooking', capabilities: 'Precise temperature control, long slow cooking' },
                    { id: 2, name: 'Cast Iron Dutch Oven', type: 'Cooking', capabilities: 'Braising, bread baking, high heat retention' }
                ]);
                setPantryItems(getDefaultPantryItems());
                setSyncStatus('synced');
            };

            const getApiKey = () => {
                let apiKey = localStorage.getItem('anthropic_api_key');
                if (!apiKey) {
                    apiKey = prompt('Please enter your Anthropic API key (starts with sk-ant-):');
                    if (apiKey) {
                        localStorage.setItem('anthropic_api_key', apiKey);
                    }
                }
                return apiKey;
            };

            // State
            const [ingredients, setIngredients] = useState([
                { id: 1, name: 'Chicken Breast', quantity: 2, unit: 'lbs', category: 'Protein', expires: '2025-08-05' },
                { id: 2, name: 'Basmati Rice', quantity: 1, unit: 'cup', category: 'Grain', expires: '2026-01-01' },
                { id: 3, name: 'Heavy Cream', quantity: 1, unit: 'cup', category: 'Dairy', expires: '2025-08-03' },
                { id: 4, name: 'Mushrooms', quantity: 8, unit: 'oz', category: 'Vegetable', expires: '2025-08-04' }
            ]);

            const [equipment, setEquipment] = useState([
                { id: 1, name: 'Sous Vide Immersion Circulator', type: 'Precision Cooking', capabilities: 'Precise temperature control, long slow cooking' },
                { id: 2, name: 'Cast Iron Dutch Oven', type: 'Cooking', capabilities: 'Braising, bread baking, high heat retention' }
            ]);

            const [pantryItems, setPantryItems] = useState(getDefaultPantryItems());

            const [activeTab, setActiveTab] = useState('ingredients');
            const [editingItem, setEditingItem] = useState(null);
            const [generatedRecipe, setGeneratedRecipe] = useState('');
            const [isGenerating, setIsGenerating] = useState(false);
            const [recipePreferences, setRecipePreferences] = useState('');
            const [isSyncing, setIsSyncing] = useState(false);
            const [syncStatus, setSyncStatus] = useState('synced');
            const [userId, setUserId] = useState(getUserId());
            const [showUserModal, setShowUserModal] = useState(false);
            const [usernameInput, setUsernameInput] = useState('');

            const syncTimeoutRef = useRef(null);

            // Effects
            useEffect(() => {
                loadDataFromDatabase();
                const interval = setInterval(loadDataFromDatabase, 30000);
                return () => clearInterval(interval);
            }, []);

            useEffect(() => {
                if (syncTimeoutRef.current) {
                    clearTimeout(syncTimeoutRef.current);
                }
                
                if (!isSyncing) {
                    syncTimeoutRef.current = setTimeout(() => {
                        saveDataToDatabase();
                    }, 1000);
                }

                return () => {
                    if (syncTimeoutRef.current) {
                        clearTimeout(syncTimeoutRef.current);
                    }
                };
            }, [ingredients, equipment, pantryItems, isSyncing]);

            // Database functions
            const loadDataFromDatabase = async () => {
                try {
                    setIsSyncing(true);
                    const response = await fetch(`/.netlify/functions/github-sync?userId=${userId}`, {
                        method: 'GET',
                    });

                    if (response.ok) {
                        const data = await response.json();
                        if (data.ingredients && data.ingredients.length > 0) {
                            setIngredients(data.ingredients);
                        }
                        if (data.equipment && data.equipment.length > 0) {
                            setEquipment(data.equipment);
                        }
                        if (data.pantryItems) {
                            setPantryItems(data.pantryItems);
                        }
                        setSyncStatus('synced');
                    } else {
                        setSyncStatus('error');
                    }
                } catch (error) {
                    console.error('Error loading data:', error);
                    setSyncStatus('error');
                } finally {
                    setIsSyncing(false);
                }
            };

            const saveDataToDatabase = async () => {
                try {
                    setSyncStatus('syncing');
                    const response = await fetch('/.netlify/functions/github-sync', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            userId: userId,
                            ingredients: ingredients,
                            equipment: equipment,
                            pantryItems: pantryItems
                        })
                    });

                    if (response.ok) {
                        setSyncStatus('synced');
                        localStorage.setItem('ingredients', JSON.stringify(ingredients));
                        localStorage.setItem('equipment', JSON.stringify(equipment));
                        localStorage.setItem('pantryItems', JSON.stringify(pantryItems));
                    } else {
                        setSyncStatus('error');
                    }
                } catch (error) {
                    console.error('Error saving data:', error);
                    setSyncStatus('error');
                    localStorage.setItem('ingredients', JSON.stringify(ingredients));
                    localStorage.setItem('equipment', JSON.stringify(equipment));
                    localStorage.setItem('pantryItems', JSON.stringify(pantryItems));
                }
            };

            // Ingredient functions
            const markAsUsed = (id) => {
                setIngredients(ingredients.filter(item => item.id !== id));
            };

            const updateQuantity = (id, newQuantity) => {
                if (newQuantity <= 0) {
                    markAsUsed(id);
                } else {
                    setIngredients(ingredients.map(item => 
                        item.id === id ? { ...item, quantity: newQuantity } : item
                    ));
                }
            };

            const addIngredient = () => {
                const newIngredient = {
                    id: Date.now(),
                    name: 'New Ingredient',
                    quantity: 1,
                    unit: 'unit',
                    category: 'Other',
                    expires: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0]
                };
                setIngredients([...ingredients, newIngredient]);
                setEditingItem({ type: 'ingredient', id: newIngredient.id });
            };

            const deleteIngredient = (id) => {
                setIngredients(ingredients.filter(item => item.id !== id));
            };

            const updateIngredient = (id, field, value) => {
                setIngredients(ingredients.map(item => 
                    item.id === id ? { ...item, [field]: value } : item
                ));
            };

            // Equipment functions
            const addEquipment = () => {
                const newEquipment = {
                    id: Date.now(),
                    name: 'New Equipment',
                    type: 'Other',
                    capabilities: 'Describe what this equipment can do'
                };
                setEquipment([...equipment, newEquipment]);
                setEditingItem({ type: 'equipment', id: newEquipment.id });
            };

            const deleteEquipment = (id) => {
                setEquipment(equipment.filter(item => item.id !== id));
            };

            const updateEquipment = (id, field, value) => {
                setEquipment(equipment.map(item => 
                    item.id === id ? { ...item, [field]: value } : item
                ));
            };

            // Pantry functions
            const togglePantryItem = (category, itemId) => {
                setPantryItems(prev => ({
                    ...prev,
                    [category]: prev[category].map(item =>
                        item.id === itemId 
                            ? { ...item, available: !item.available }
                            : item
                    )
                }));
            };

            const addCustomPantryItem = (category, itemName) => {
                if (!itemName || itemName.trim() === '') return;
                
                const newItem = {
                    id: Date.now(),
                    name: itemName.trim(),
                    available: true
                };
                
                setPantryItems(prev => ({
                    ...prev,
                    [category]: [...prev[category], newItem]
                }));
            };

            const deletePantryItem = (category, itemId) => {
                setPantryItems(prev => ({
                    ...prev,
                    [category]: prev[category].filter(item => item.id !== itemId)
                }));
            };

            // Recipe generation
            const generateRecipe = async () => {
                const apiKey = getApiKey();
                if (!apiKey) {
                    alert('API key is required to generate recipes');
                    return;
                }

                setIsGenerating(true);
                setGeneratedRecipe('');

                try {
                    const ingredientsList = ingredients.map(ing => 
                        `${ing.name} (${ing.quantity} ${ing.unit})`
                    ).join(', ');

                    const equipmentList = equipment.map(eq => 
                        `${eq.name} - ${eq.capabilities}`
                    ).join(', ');

                    // Get available pantry items
                    const availablePantryItems = {};
                    Object.keys(pantryItems).forEach(category => {
                        const available = pantryItems[category].filter(item => item.available);
                        if (available.length > 0) {
                            availablePantryItems[category] = available.map(item => item.name);
                        }
                    });

                    const pantryItemsText = Object.keys(availablePantryItems).length > 0 
                        ? Object.entries(availablePantryItems)
                            .map(([category, items]) => `${category}: ${items.join(', ')}`)
                            .join(' | ')
                        : 'Basic salt and pepper only';

                    const prompt = `Create a detailed recipe using ONLY these available ingredients and pantry items:

MAIN INGREDIENTS: ${ingredientsList}

AVAILABLE PANTRY ITEMS: ${pantryItemsText}

AVAILABLE EQUIPMENT: ${equipmentList}

USER PREFERENCES: ${recipePreferences || 'No specific preferences'}

IMPORTANT CONSTRAINTS:
- You may ONLY use ingredients from the "MAIN INGREDIENTS" and "AVAILABLE PANTRY ITEMS" lists above
- Do NOT suggest any ingredients not listed above
- Do NOT assume any pantry staples beyond what is explicitly listed
- If you need something not available, suggest a substitution using only available items OR mention the recipe cannot be made without purchasing additional ingredients

Please create a recipe that:
1. Uses ONLY the ingredients and pantry items listed above
2. Takes advantage of available kitchen equipment when possible
3. Includes clear step-by-step instructions
4. Mentions cooking times and temperatures
5. If the available ingredients are insufficient for a complete recipe, clearly state what additional items would need to be purchased

Format the recipe with a clear title, ingredient list (using only available items), and numbered steps.`;

                    const response = await fetch("/.netlify/functions/generate-recipe", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify({
                            prompt: prompt,
                            apiKey: apiKey
                        })
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.error || `Request failed: ${response.status}`);
                    }

                    const data = await response.json();
                    setGeneratedRecipe(data.content[0].text);
                } catch (error) {
                    console.error("Error generating recipe:", error);
                    setGeneratedRecipe(`Error generating recipe: ${error.message}`);
                } finally {
                    setIsGenerating(false);
                }
            };

            // Utility functions
            const isExpiringSoon = (expirationDate) => {
                const today = new Date();
                const expiry = new Date(expirationDate);
                const diffTime = expiry - today;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                return diffDays <= 3 && diffDays >= 0;
            };

            const expiringSoon = ingredients.filter(ing => isExpiringSoon(ing.expires));

            const getSyncStatusInfo = () => {
                switch (syncStatus) {
                    case 'syncing':
                        return { 
                            color: 'text-blue-500', 
                            text: 'Syncing...', 
                            icon: <Cloud className="sync-indicator" /> 
                        };
                    case 'synced':
                        return { 
                            color: 'text-green-500', 
                            text: 'Synced', 
                            icon: <Cloud /> 
                        };
                    case 'error':
                        return { 
                            color: 'text-red-500', 
                            text: 'Sync Error', 
                            icon: <Cloud /> 
                        };
                    default:
                        return { 
                            color: 'text-gray-500', 
                            text: 'Unknown', 
                            icon: <Cloud /> 
                        };
                }
            };

            const statusInfo = getSyncStatusInfo();

            // Helper function to render pantry sections with dividers
            const renderPantrySection = (title, category, emoji = '') => {
                const items = pantryItems[category] || [];
                const availableCount = items.filter(item => item.available).length;
                
                return (
                    <div className="mb-6">
                        <div className="flex items-center justify-between mb-3">
                            <h4 className="font-medium text-gray-700 text-sm">
                                {emoji} {title} <span className="text-blue-600">({availableCount})</span>
                            </h4>
                            <button
                                onClick={() => {
                                    const itemName = prompt(`Add custom ${title.toLowerCase()}:`);
                                    if (itemName) addCustomPantryItem(category, itemName);
                                }}
                                className="text-xs bg-gray-100 hover:bg-gray-200 text-gray-600 px-2 py-1 rounded"
                            >
                                + Add
                            </button>
                        </div>
                        <div className="grid grid-cols-2 md:grid-cols-3 gap-2">
                            {items.map(item => (
                                <div
                                    key={item.id}
                                    className={`p-2 rounded border transition-colors text-xs ${
                                        item.available 
                                            ? 'border-green-300 bg-green-50' 
                                            : 'border-gray-200 bg-gray-50'
                                    }`}
                                >
                                    <div className="flex items-center justify-between">
                                        <label 
                                            className="flex items-center gap-2 cursor-pointer flex-1"
                                            onClick={() => togglePantryItem(category, item.id)}
                                        >
                                            <input
                                                type="checkbox"
                                                checked={item.available}
                                                onChange={() => togglePantryItem(category, item.id)}
                                                className="w-3 h-3 text-green-600 rounded focus:ring-green-500"
                                            />
                                            <span className={`font-medium leading-tight ${
                                                item.available ? 'text-green-800' : 'text-gray-600'
                                            }`}>
                                                {item.name}
                                            </span>
                                        </label>
                                        {item.id > 1000 && (
                                            <button
                                                onClick={() => deletePantryItem(category, item.id)}
                                                className="text-red-500 hover:text-red-700 p-1 ml-1"
                                                title="Delete custom item"
                                            >
                                                <Trash2 size={10} />
                                            </button>
                                        )}
                                    </div>
                                </div>
                            ))}
                        </div>
                        <div className="section-divider"></div>
                    </div>
                );
            };

            return (
                <div className="max-w-7xl mx-auto p-4 bg-gray-50 min-h-screen">
                    {/* Header */}
                    <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
                        <div className="flex justify-between items-start">
                            <div>
                                <h1 className="text-3xl font-bold text-gray-800 mb-2 flex items-center gap-2">
                                    <ChefHat className="text-orange-500" />
                                    Kitchen Recipe Generator
                                </h1>
                                <p className="text-gray-600">üéØ Manage your kitchen inventory and generate AI recipes</p>
                            </div>
                            <div className="flex items-center gap-2 text-sm">
                                <div className={`flex items-center gap-1 ${statusInfo.color}`}>
                                    {statusInfo.icon}
                                    <span>{statusInfo.text}</span>
                                </div>
                                <button
                                    onClick={() => setShowUserModal(true)}
                                    className="bg-purple-500 text-white px-3 py-1 rounded text-xs hover:bg-purple-600 flex items-center gap-1"
                                    title="Manage User"
                                >
                                    <User size={12} />
                                    User
                                </button>
                                <button
                                    onClick={() => {
                                        loadDataFromDatabase();
                                        saveDataToDatabase();
                                    }}
                                    className="bg-blue-500 text-white px-3 py-1 rounded text-xs hover:bg-blue-600"
                                    disabled={isSyncing}
                                >
                                    {isSyncing ? 'Syncing...' : 'Force Sync'}
                                </button>
                            </div>
                        </div>
                    </div>

                    {/* Expiring Soon Alert */}
                    {expiringSoon.length > 0 && (
                        <div className="bg-red-50 border border-red-200 rounded-lg p-4 mb-6">
                            <div className="flex items-center gap-2 mb-2">
                                <AlertTriangle className="text-red-500" />
                                <h3 className="font-semibold text-red-800">Ingredients Expiring Soon!</h3>
                            </div>
                            <div className="text-red-700 text-sm">
                                {expiringSoon.map(ing => ing.name).join(', ')} - Consider using these first!
                            </div>
                        </div>
                    )}

                    <div className="grid grid-cols-1 xl:grid-cols-2 gap-6">
                        {/* Left Panel - Inventory Management */}
                        <div className="bg-white rounded-lg shadow-lg p-6">
                            <div className="flex gap-2 mb-6 flex-wrap">
                                <button
                                    onClick={() => setActiveTab('ingredients')}
                                    className={`px-4 py-2 rounded-lg font-medium transition-colors ${
                                        activeTab === 'ingredients' 
                                            ? 'bg-blue-500 text-white' 
                                            : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                                    }`}
                                >
                                    ü•ò Ingredients ({ingredients.length})
                                </button>
                                <button
                                    onClick={() => setActiveTab('equipment')}
                                    className={`px-4 py-2 rounded-lg font-medium transition-colors flex items-center gap-2 ${
                                        activeTab === 'equipment' 
                                            ? 'bg-blue-500 text-white' 
                                            : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                                    }`}
                                >
                                    <Utensils />
                                    Equipment ({equipment.length})
                                </button>
                                <button
                                    onClick={() => setActiveTab('pantry')}
                                    className={`px-4 py-2 rounded-lg font-medium transition-colors ${
                                        activeTab === 'pantry' 
                                            ? 'bg-green-500 text-white' 
                                            : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                                    }`}
                                >
                                    üè™ Pantry Items
                                </button>
                            </div>

                            {/* Tab Content */}
                            {activeTab === 'ingredients' && (
                                <div>
                                    <div className="flex justify-between items-center mb-4">
                                        <h2 className="text-xl font-semibold text-gray-800">Your Ingredients</h2>
                                        <button
                                            onClick={addIngredient}
                                            className="bg-green-500 text-white px-3 py-2 rounded-lg hover:bg-green-600 transition-colors flex items-center gap-2 text-sm"
                                        >
                                            <Plus />
                                            Add
                                        </button>
                                    </div>
                                    
                                    <div className="space-y-3 max-h-96 overflow-y-auto">
                                        {ingredients.map(ingredient => (
                                            <div
                                                key={ingredient.id}
                                                className={`p-4 rounded-lg border-2 ${
                                                    isExpiringSoon(ingredient.expires) ? 'border-red-300 bg-red-50' : 'border-gray-200 bg-gray-50'
                                                }`}
                                            >
                                                {editingItem?.type === 'ingredient' && editingItem?.id === ingredient.id ? (
                                                    <div className="space-y-3">
                                                        <input
                                                            value={ingredient.name}
                                                            onChange={(e) => updateIngredient(ingredient.id, 'name', e.target.value)}
                                                            className="w-full p-2 border rounded-lg"
                                                            placeholder="Ingredient name"
                                                        />
                                                        <div className="grid grid-cols-3 gap-2">
                                                            <input
                                                                type="number"
                                                                step="0.1"
                                                                value={ingredient.quantity}
                                                                onChange={(e) => updateIngredient(ingredient.id, 'quantity', parseFloat(e.target.value))}
                                                                className="p-2 border rounded-lg"
                                                                placeholder="Qty"
                                                            />
                                                            <input
                                                                value={ingredient.unit}
                                                                onChange={(e) => updateIngredient(ingredient.id, 'unit', e.target.value)}
                                                                className="p-2 border rounded-lg"
                                                                placeholder="Unit"
                                                            />
                                                            <input
                                                                type="date"
                                                                value={ingredient.expires}
                                                                onChange={(e) => updateIngredient(ingredient.id, 'expires', e.target.value)}
                                                                className="p-2 border rounded-lg"
                                                            />
                                                        </div>
                                                        <input
                                                            value={ingredient.category}
                                                            onChange={(e) => updateIngredient(ingredient.id, 'category', e.target.value)}
                                                            className="w-full p-2 border rounded-lg"
                                                            placeholder="Category (e.g., Protein, Vegetable)"
                                                        />
                                                        <div className="flex gap-2">
                                                            <button
                                                                onClick={() => setEditingItem(null)}
                                                                className="bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600"
                                                            >
                                                                Save
                                                            </button>
                                                            <button
                                                                onClick={() => setEditingItem(null)}
                                                                className="bg-gray-500 text-white px-3 py-1 rounded text-sm hover:bg-gray-600"
                                                            >
                                                                Cancel
                                                            </button>
                                                        </div>
                                                    </div>
                                                ) : (
                                                    <div className="flex justify-between items-start">
                                                        <div className="flex-1">
                                                            <div className="font-medium text-gray-800 text-lg">{item.name}</div>
                                                            <div className="text-sm text-blue-600 mb-2">{item.type}</div>
                                                            <div className="text-sm text-gray-600 leading-relaxed">{item.capabilities}</div>
                                                        </div>
                                                        <div className="flex gap-1 ml-4">
                                                            <button
                                                                onClick={() => setEditingItem({ type: 'equipment', id: item.id })}
                                                                className="text-blue-500 hover:text-blue-700 p-1"
                                                                title="Edit"
                                                            >
                                                                <Edit2 />
                                                            </button>
                                                            <button
                                                                onClick={() => deleteEquipment(item.id)}
                                                                className="text-red-500 hover:text-red-700 p-1"
                                                                title="Delete"
                                                            >
                                                                <Trash2 />
                                                            </button>
                                                        </div>
                                                    </div>
                                                )}
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {/* Enhanced Pantry Tab */}
                            {activeTab === 'pantry' && (
                                <div>
                                    <div className="flex justify-between items-center mb-4">
                                        <h2 className="text-xl font-semibold text-gray-800">Pantry & Staples</h2>
                                        <div className="text-sm text-blue-600">
                                            Total Available: {Object.values(pantryItems).flat().filter(item => item.available).length}
                                        </div>
                                    </div>
                                    
                                    <div className="max-h-96 overflow-y-auto space-y-4">
                                        {/* Oils & Fats Section */}
                                        {renderPantrySection('Oils & Fats', 'oils', 'ü´í')}
                                        
                                        {/* Seasonings Sections */}
                                        {renderPantrySection('Dried Herbs', 'herbs', 'üåø')}
                                        {renderPantrySection('Spices', 'spices', 'üå∂Ô∏è')}
                                        {renderPantrySection('Seasoning Blends', 'blends', 'üßÇ')}
                                        {renderPantrySection('Salts', 'salts', 'üßÇ')}
                                        {renderPantrySection('Other Seasonings', 'other_seasonings', '‚ú®')}
                                        
                                        {/* Acids & Liquids */}
                                        {renderPantrySection('Vinegars', 'vinegars', 'üç∂')}
                                        {renderPantrySection('Asian & Global Sauces', 'sauces', 'ü•¢')}
                                        {renderPantrySection('Western Condiments', 'condiments', 'üçØ')}
                                        
                                        {/* Sweeteners */}
                                        {renderPantrySection('Sweeteners', 'sweeteners', 'üçØ')}
                                        
                                        {/* Dry Goods */}
                                        {renderPantrySection('Grains & Flour', 'grains', 'üåæ')}
                                        {renderPantrySection('Pasta & Noodles', 'pasta', 'üçù')}
                                        {renderPantrySection('Canned Goods', 'canned', 'ü•´')}
                                        {renderPantrySection('Baking Essentials', 'baking', 'üßÅ')}
                                    </div>
                                    
                                    <div className="mt-4 p-3 bg-green-50 rounded-lg border border-green-200">
                                        <p className="text-sm text-green-700 mb-2">
                                            <strong>üí° Pantry Tips:</strong>
                                        </p>
                                        <ul className="text-xs text-green-600 space-y-1">
                                            <li>‚Ä¢ Check items you currently have available</li>
                                            <li>‚Ä¢ Only checked items will be used in recipe generation</li>
                                            <li>‚Ä¢ Add custom items if you have something not listed</li>
                                            <li>‚Ä¢ Organize by section to find items quickly</li>
                                        </ul>
                                        <div className="mt-2 pt-2 border-t border-green-300">
                                            <p className="text-xs text-green-600">
                                                <strong>Currently available:</strong> {
                                                    Object.values(pantryItems).flat().filter(item => item.available).length > 0
                                                        ? `${Object.values(pantryItems).flat().filter(item => item.available).length} items selected`
                                                        : 'No pantry items selected'
                                                }
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>

                        {/* Right Panel - Recipe Generation */}
                        <div className="bg-white rounded-lg shadow-lg p-6">
                            <h2 className="text-xl font-semibold text-gray-800 mb-4 flex items-center gap-2">
                                <ChefHat className="text-orange-500" />
                                Generate Recipe
                            </h2>
                            
                            <div className="mb-4">
                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                    Preferences & Notes (optional)
                                </label>
                                <textarea
                                    value={recipePreferences}
                                    onChange={(e) => setRecipePreferences(e.target.value)}
                                    className="w-full p-3 border rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500"
                                    placeholder="e.g., 'vegetarian', 'under 30 minutes', 'comfort food', 'use the sous vide', 'low carb'"
                                    rows={3}
                                />
                            </div>

                            {/* Current Inventory Summary */}
                            <div className="mb-4 p-3 bg-blue-50 rounded-lg border border-blue-200">
                                <h3 className="font-medium text-blue-800 mb-2">üìã Current Inventory Summary:</h3>
                                <div className="text-sm text-blue-700 space-y-1">
                                    <div>ü•ò <strong>Ingredients:</strong> {ingredients.length} items</div>
                                    <div>üîß <strong>Equipment:</strong> {equipment.length} items</div>
                                    <div>üè™ <strong>Pantry Items:</strong> {Object.values(pantryItems).flat().filter(item => item.available).length} available</div>
                                </div>
                                {ingredients.length === 0 && (
                                    <div className="mt-2 text-xs text-orange-600">
                                        ‚ö†Ô∏è Add main ingredients to generate recipes
                                    </div>
                                )}
                            </div>

                            <button
                                onClick={generateRecipe}
                                disabled={isGenerating || ingredients.length === 0}
                                className="w-full bg-orange-500 text-white py-3 px-4 rounded-lg hover:bg-orange-600 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center justify-center gap-2 mb-4"
                            >
                                {isGenerating ? (
                                    <>
                                        <div className="animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"></div>
                                        Generating Recipe...
                                    </>
                                ) : (
                                    <>
                                        <ChefHat size={20} />
                                        Generate Recipe ({ingredients.length} ingredients + {Object.values(pantryItems).flat().filter(item => item.available).length} pantry items)
                                    </>
                                )}
                            </button>

                            {ingredients.length === 0 && (
                                <p className="text-sm text-gray-500 text-center mb-4">
                                    Add some ingredients first to generate recipes!
                                </p>
                            )}

                            {generatedRecipe && (
                                <div className="mt-4 p-4 bg-gray-50 rounded-lg border max-h-96 overflow-y-auto">
                                    <h3 className="font-semibold text-gray-800 mb-3 flex items-center gap-2">
                                        <ChefHat className="text-orange-500" size={18} />
                                        Your Custom Recipe:
                                    </h3>
                                    <div className="whitespace-pre-wrap text-gray-700 text-sm leading-relaxed">
                                        {generatedRecipe}
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>

                    {/* User Management Modal */}
                    {showUserModal && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                            <div className="bg-white rounded-lg p-6 max-w-md w-full">
                                <div className="flex justify-between items-center mb-4">
                                    <h3 className="text-lg font-semibold flex items-center gap-2">
                                        <User />
                                        User Management
                                    </h3>
                                    <button
                                        onClick={() => setShowUserModal(false)}
                                        className="text-gray-500 hover:text-gray-700"
                                    >
                                        <X />
                                    </button>
                                </div>
                                
                                <div className="space-y-4">
                                    <div>
                                        <p className="text-sm text-gray-600 mb-2">
                                            Current User: <span className="font-mono bg-gray-100 px-2 py-1 rounded">
                                                {userId.startsWith('user_') ? 'Anonymous User' : userId}
                                            </span>
                                        </p>
                                        {userId.startsWith('user_') && (
                                            <p className="text-xs text-orange-600 mb-3">
                                                ‚ö†Ô∏è You're using an anonymous account. Set a username to access your data from other devices.
                                            </p>
                                        )}
                                    </div>

                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">
                                            Set Username (to sync across devices)
                                        </label>
                                        <input
                                            type="text"
                                            value={usernameInput}
                                            onChange={(e) => setUsernameInput(e.target.value)}
                                            className="w-full p-2 border rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"
                                            placeholder="e.g., john, mary_kitchen, chef123"
                                            maxLength={20}
                                        />
                                        <p className="text-xs text-gray-500 mt-1">
                                            Only letters, numbers, hyphens, and underscores. 2-20 characters.
                                        </p>
                                    </div>

                                    <div className="flex gap-2">
                                        <button
                                            onClick={() => {
                                                if (setUsername(usernameInput)) {
                                                    setUsernameInput('');
                                                }
                                            }}
                                            className="flex-1 bg-purple-500 text-white py-2 px-4 rounded-lg hover:bg-purple-600"
                                            disabled={!usernameInput.trim()}
                                        >
                                            Set Username
                                        </button>
                                        {!userId.startsWith('user_') && (
                                            <button
                                                onClick={() => {
                                                    if (confirm('This will reset you to an anonymous user and clear your current data. Are you sure?')) {
                                                        clearUsername();
                                                    }
                                                }}
                                                className="bg-red-500 text-white py-2 px-4 rounded-lg hover:bg-red-600"
                                            >
                                                Reset to Anonymous
                                            </button>
                                        )}
                                    </div>

                                    <div className="bg-blue-50 p-3 rounded-lg">
                                        <h4 className="font-medium text-blue-800 mb-2">How it works:</h4>
                                        <ul className="text-xs text-blue-700 space-y-1">
                                            <li>‚Ä¢ Set the same username on all your devices</li>
                                            <li>‚Ä¢ Your data will automatically sync between them</li>
                                            <li>‚Ä¢ Use simple names like "john" or "kitchen_main"</li>
                                            <li>‚Ä¢ No password needed - just remember your username</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Footer */}
                    <div className="mt-6 bg-gradient-to-r from-blue-50 to-green-50 border border-blue-200 rounded-lg p-4">
                        <div className="text-center">
                            <h3 className="font-semibold text-blue-800 mb-1">üéØ Real-time Sync Enabled!</h3>
                            <p className="text-blue-700 text-sm">
                                ‚Ä¢ Changes sync automatically across all your devices ‚Ä¢ Use any device - phone, laptop, tablet ‚Ä¢ Data is backed up in the cloud
                            </p>
                            <p className="text-blue-600 text-xs mt-2">
                                üì± Current User: <span className="font-mono bg-blue-100 px-1 rounded">
                                    {userId.startsWith('user_') ? 'Anonymous User' : userId}
                                </span> 
                                {userId.startsWith('user_') && (
                                    <span className="text-gray-500"> (Click "User" button to set a username)</span>
                                )}
                            </p>
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<RecipeGenerator />, document.getElementById('root'));
    </script>
</body>
</html>
                                                            </button>
                                                            <button
                                                                onClick={() => setEditingItem(null)}
                                                                className="bg-gray-500 text-white px-3 py-1 rounded text-sm hover:bg-gray-600"
                                                            >
                                                                Cancel
                                                            </button>
                                                        </div>
                                                    </div>
                                                ) : (
                                                    <div>
                                                        <div className="flex justify-between items-start mb-2">
                                                            <div className="flex-1">
                                                                <div className="font-medium text-gray-800 text-lg">{ingredient.name}</div>
                                                                <div className="text-sm text-gray-600">
                                                                    <span className="font-medium">{ingredient.quantity} {ingredient.unit}</span>
                                                                    <span className="mx-2">‚Ä¢</span>
                                                                    <span className="text-blue-600">{ingredient.category}</span>
                                                                </div>
                                                                <div className="text-xs text-gray-500 mt-1">
                                                                    Expires: {ingredient.expires}
                                                                    {isExpiringSoon(ingredient.expires) && (
                                                                        <span className="text-red-600 font-medium ml-2">‚ö†Ô∏è Use Soon!</span>
                                                                    )}
                                                                </div>
                                                            </div>
                                                            <div className="flex gap-1 ml-4">
                                                                <button
                                                                    onClick={() => setEditingItem({ type: 'ingredient', id: ingredient.id })}
                                                                    className="text-blue-500 hover:text-blue-700 p-1"
                                                                    title="Edit"
                                                                >
                                                                    <Edit2 />
                                                                </button>
                                                                <button
                                                                    onClick={() => markAsUsed(ingredient.id)}
                                                                    className="text-orange-500 hover:text-orange-700 p-1"
                                                                    title="Mark as Used"
                                                                >
                                                                    <Check />
                                                                </button>
                                                                <button
                                                                    onClick={() => deleteIngredient(ingredient.id)}
                                                                    className="text-red-500 hover:text-red-700 p-1"
                                                                    title="Delete"
                                                                >
                                                                    <Trash2 />
                                                                </button>
                                                            </div>
                                                        </div>
                                                        
                                                        {/* Quick quantity controls */}
                                                        <div className="flex items-center gap-2 mt-2">
                                                            <span className="text-xs text-gray-500">Quick update:</span>
                                                            <button
                                                                onClick={() => updateQuantity(ingredient.id, ingredient.quantity - 1)}
                                                                className="bg-red-100 text-red-600 hover:bg-red-200 rounded px-2 py-1 text-xs"
                                                                disabled={ingredient.quantity <= 1}
                                                            >
                                                                -1
                                                            </button>
                                                            <button
                                                                onClick={() => updateQuantity(ingredient.id, ingredient.quantity / 2)}
                                                                className="bg-yellow-100 text-yellow-600 hover:bg-yellow-200 rounded px-2 py-1 text-xs"
                                                            >
                                                                √∑2
                                                            </button>
                                                            <button
                                                                onClick={() => updateQuantity(ingredient.id, ingredient.quantity + 1)}
                                                                className="bg-green-100 text-green-600 hover:bg-green-200 rounded px-2 py-1 text-xs"
                                                            >
                                                                +1
                                                            </button>
                                                        </div>
                                                    </div>
                                                )}
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {activeTab === 'equipment' && (
                                <div>
                                    <div className="flex justify-between items-center mb-4">
                                        <h2 className="text-xl font-semibold text-gray-800">Your Equipment</h2>
                                        <button
                                            onClick={addEquipment}
                                            className="bg-green-500 text-white px-3 py-2 rounded-lg hover:bg-green-600 transition-colors flex items-center gap-2 text-sm"
                                        >
                                            <Plus />
                                            Add
                                        </button>
                                    </div>
                                    
                                    <div className="space-y-3 max-h-96 overflow-y-auto">
                                        {equipment.map(item => (
                                            <div key={item.id} className="p-4 rounded-lg border-2 border-gray-200 bg-gray-50">
                                                {editingItem?.type === 'equipment' && editingItem?.id === item.id ? (
                                                    <div className="space-y-3">
                                                        <input
                                                            value={item.name}
                                                            onChange={(e) => updateEquipment(item.id, 'name', e.target.value)}
                                                            className="w-full p-2 border rounded-lg"
                                                            placeholder="Equipment name"
                                                        />
                                                        <input
                                                            value={item.type}
                                                            onChange={(e) => updateEquipment(item.id, 'type', e.target.value)}
                                                            className="w-full p-2 border rounded-lg"
                                                            placeholder="Type/Category"
                                                        />
                                                        <textarea
                                                            value={item.capabilities}
                                                            onChange={(e) => updateEquipment(item.id, 'capabilities', e.target.value)}
                                                            className="w-full p-2 border rounded-lg"
                                                            placeholder="What can this equipment do?"
                                                            rows={3}
                                                        />
                                                        <div className="flex gap-2">
                                                            <button
                                                                onClick={() => setEditingItem(null)}
                                                                className="bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600"
                                                            >
                                                                Save
